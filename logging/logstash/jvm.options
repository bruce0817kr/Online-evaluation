# JVM Options for Logstash
# WARNING: DO NOT EDIT this file directly. Use environment variables or 
# override files to customize JVM settings.

# Xms represents the initial size of total heap space
# Xmx represents the maximum size of total heap space

# Development Environment Settings (2GB heap)
-Xms2g
-Xmx2g

# Production Environment Settings (4GB heap) - uncomment for production
# -Xms4g
# -Xmx4g

# ============================= GARBAGE COLLECTION =============================

# Use G1GC for better performance with large heaps
-XX:+UseG1GC

# G1 specific settings
-XX:G1HeapRegionSize=32m
-XX:+UnlockExperimentalVMOptions
-XX:+UseCGroupMemoryLimitForHeap

# GC logging
-Xlog:gc*,gc+heap=info,safepoint:gc.log:time,pid,tid,level,tags

# ============================= PERFORMANCE OPTIMIZATIONS =============================

# Disable explicit GC calls
-XX:+DisableExplicitGC

# Pre-touch memory pages
-XX:+AlwaysPreTouch

# Use server JVM
-server

# Enable string deduplication
-XX:+UseStringDeduplication

# Use compressed OOPs for memory efficiency
-XX:+UseCompressedOops

# Optimize for throughput
-XX:+UseCompressedClassPointers

# ============================= MEMORY MANAGEMENT =============================

# Heap dump on OutOfMemoryError
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=/usr/share/logstash/logs/

# Exit on OutOfMemoryError
-XX:+ExitOnOutOfMemoryError

# ============================= SECURITY SETTINGS =============================

# Security manager (disabled for Logstash)
-Djava.security.manager=default

# Security policy
-Djava.security.policy=all.permissions

# Disable security manager for performance
# -Djava.security.manager=

# ============================= NETWORK SETTINGS =============================

# Prefer IPv4
-Djava.net.preferIPv4Stack=true

# Network timeout settings
-Djava.net.useSystemProxies=true

# ============================= FILE SYSTEM SETTINGS =============================

# File encoding
-Dfile.encoding=UTF-8

# Temporary directory
-Djava.io.tmpdir=/tmp/logstash

# ============================= JVM INTERNAL SETTINGS =============================

# Enable modern Java features
-XX:+UseStringDeduplication

# Optimize for container environments
-XX:+UnlockExperimentalVMOptions
-XX:+UseCGroupMemoryLimitForHeap

# ============================= DEBUGGING (DEVELOPMENT ONLY) =============================

# Enable JMX for monitoring (uncomment for debugging)
# -Dcom.sun.management.jmxremote
# -Dcom.sun.management.jmxremote.port=9999
# -Dcom.sun.management.jmxremote.authenticate=false
# -Dcom.sun.management.jmxremote.ssl=false

# Enable JFR (Java Flight Recorder) for profiling
# -XX:+FlightRecorder
# -XX:StartFlightRecording=duration=60s,filename=logstash-profile.jfr

# ============================= SYSTEM PROPERTIES =============================

# Logstash specific system properties
-Dlogstash.jackson.stream-read-constraints.max-string-length=200000000
-Dlogstash.jackson.stream-read-constraints.max-number-length=10000

# Log4j2 properties
-Dlog4j2.disable.jmx=true
-Dlog4j.shutdownHookEnabled=false
-Dlog4j.skipJansi=true

# JNA properties (for native library access)
-Djna.nosys=true

# Netty properties
-Dio.netty.noUnsafe=true
-Dio.netty.noKeySetOptimization=true
-Dio.netty.recycler.maxCapacityPerThread=0

# ============================= WARNING SUPPRESSIONS =============================

# Suppress reflective access warnings (Java 9+)
--add-opens=java.base/java.security=ALL-UNNAMED
--add-opens=java.base/java.io=ALL-UNNAMED
--add-opens=java.base/java.nio.channels=ALL-UNNAMED
--add-opens=java.base/sun.nio.ch=ALL-UNNAMED
--add-opens=java.management/sun.management=ALL-UNNAMED

# ============================= LOGSTASH SPECIFIC =============================

# Plugin classloader isolation
-Djruby.compile.invokedynamic=false
-Djruby.jit.threshold=0

# Elastic APM (if enabled)
# -javaagent:/usr/share/logstash/elastic-apm-agent.jar
# -Delastic.apm.service_name=logstash
# -Delastic.apm.application_packages=org.logstash
